<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Opening CODA…</title>

    <meta name="apple-itunes-app" content="app-id=0000000000" />

    <script>
      const params = new URLSearchParams(window.location.search);
      const path = params.get("path");

      if (!path) {
        window.location.href = "/";
      }

      params.delete("path");
      const query = params.toString();
      const fullPath = query ? `${path}?${query}` : path;

      const domain = window.location.origin;

      const iosStore = "https://apps.apple.com/pk/app/coda/idXXXXXXXXX";

      const androidStore =
        "https://play.google.com/store/apps/details?id=com.cwl.coda";

      const ua = navigator.userAgent || navigator.vendor;
      let fallbackTimer;

      function launchAndroid() {
        const universal = `${domain}${fullPath}`;
        window.location.href = universal;

        fallbackTimer = setTimeout(() => {
          window.location.href = androidStore;
        }, 2000);
      }

      function launchIOS() {
        const iosScheme = `coda://${fullPath}`;
        window.location.href = iosScheme;

        fallbackTimer = setTimeout(() => {
          window.location.href = iosStore;
        }, 2000);
      }

      window.onload = () => {
        if (/android/i.test(ua)) {
          launchAndroid();
        } else {
          launchIOS();
        }
      };

      document.addEventListener("visibilitychange", () => {
        if (document.hidden && fallbackTimer) {
          clearTimeout(fallbackTimer);
        }
      });
    </script>
  </head>

  <body>
    <p>Opening CODA…</p>
  </body>
</html>
