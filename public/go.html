<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Opening CODA…</title>

    <!-- iOS Smart Banner (optional but recommended) 
   Dummy content link (replace when live) -->
    <meta name="apple-itunes-app" content="app-id=0000000000" />

    <script>
      const params = new URLSearchParams(window.location.search);
      const path = params.get("path") || "";
      params.delete("path");
      const query = params.toString();
      const fullPath = query ? `${path}?${query}` : path;

      const domain = "https://dynamic-links-bay.vercel.app";

      // Universal/App Links
      const appLink = `${domain}${fullPath}`;
      console.log("App Link:", appLink);

      // Store links (dummy for now)
      const iosStore = "https://apps.apple.com/app/id0000000000";
      const androidStore =
        "https://play.google.com/store/apps/details?id=com.cwl.coda";

      const ua = navigator.userAgent || navigator.vendor;

      function openApp() {
        if (/iPad|iPhone|iPod/.test(ua)) {
          // Open the app via Universal Link (iOS handles it)
          console.log("iOS detected, attempting to open app. App Link:", appLink);
          window.location.href = appLink;

          // Fallback to App Store if app not installed
          setTimeout(() => {
            window.location.href = iosStore;
          }, 2000);
        } else if (/android/i.test(ua)) {
          console.log("Android detected, attempting to open app. App Link:", appLink);
          // Android
          window.location.href = appLink;
          setTimeout(() => {
            window.location.href = androidStore;
          }, 2000);
        } else {
          // Desktop fallback
          document.body.innerHTML = "Please open this link on mobile.";
        }
      }

      window.onload = openApp;
    </script>
  </head>
  <body>
    <p>Opening CODA…</p>
  </body>
</html>
